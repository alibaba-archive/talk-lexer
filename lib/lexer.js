// Generated by CoffeeScript 1.8.0
(function() {
  var Lexer, lexer, toString;

  toString = Object.prototype.toString;

  Lexer = (function() {
    function Lexer(structure) {
      this.structure = structure;
      if (toString.call(this.structure) !== '[object Array]') {
        this.structure = [this.structure];
      }
    }

    Lexer.prototype.html = function() {
      return this.structure.map(function(node) {
        var attrs, data, k, text, type, v;
        if (toString.call(node) === '[object String]') {
          return node;
        }
        if (node == null) {
          return '';
        }
        type = node.type, text = node.text, data = node.data;
        if (!lexer.whitelist[type]) {
          return '';
        }
        data || (data = {});
        attrs = (function() {
          var _results;
          _results = [];
          for (k in data) {
            v = data[k];
            _results.push("data-" + k + "=\"" + v + "\"");
          }
          return _results;
        })();
        return "<" + type + " " + (attrs.join(' ')) + ">" + text + "</" + type + ">";
      }).join('');
    };

    Lexer.prototype.text = function() {
      return this.structure.map(function(node) {
        var data, text, type;
        if (toString.call(node) === '[object String]') {
          return node;
        }
        if (node == null) {
          return '';
        }
        type = node.type, text = node.text, data = node.data;
        if (!lexer.whitelist[type]) {
          return '';
        }
        return text || '';
      }).join('');
    };

    Lexer.prototype.toJSON = function() {
      return this.structure;
    };

    Lexer.prototype.isValid = function() {
      return this.structure.every(function(obj) {
        return toString.call(obj) === '[object String]' || lexer.whitelist[obj != null ? obj.type : void 0];
      });
    };

    return Lexer;

  })();

  lexer = function(structure) {
    return new Lexer(structure);
  };

  lexer.name = 'lexer';

  lexer.version = 1;

  lexer.whitelist = require('./whitelist');

  lexer.parser = require('./parser');

  lexer.parseDOM = function() {
    var structure;
    structure = lexer.parser.parseDOM.apply(lexer.parser, arguments);
    return new Lexer(structure);
  };

  module.exports = lexer;

  if (typeof window !== "undefined" && window !== null) {
    window.lexer = lexer;
  }

}).call(this);
